<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ingredient Translator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(1200px 600px at top, #1c1f3a, #0e0f1a);
      color: #f1f1f1;
      font-size: 22px;
      line-height: 1.6;
    }

    h1 { font-size: 46px; margin-bottom: 10px; }
    h2 { font-size: 34px; }
    h3 { font-size: 28px; }

    .container {
      max-width: 720px;
      margin: 0 auto;
      padding: 24px;
    }

    button, input, textarea {
      font-size: 22px;
      padding: 14px 18px;
      border-radius: 16px;
      border: none;
    }

    button {
      background: linear-gradient(135deg, #1dd1a1, #10ac84);
      color: #02110c;
      font-weight: 800;
      cursor: pointer;
    }

    textarea {
      width: 100%;
      margin-top: 12px;
      min-height: 120px;
    }

    .card {
      background: rgba(255,255,255,0.05);
      border-radius: 24px;
      padding: 20px;
      margin-top: 20px;
    }

    .product-header {
      text-align: center;
    }

    #productImage {
      width: 260px;
      height: auto;
      border-radius: 20px;
      margin: 16px auto;
      display: none;
      cursor: zoom-in;
    }

    .meta {
      opacity: 0.85;
      font-weight: 700;
      margin-top: 6px;
    }

    .serving {
      margin-top: 10px;
      font-weight: 800;
    }

    /* INGREDIENT COLOR SYSTEM */
    .ingredient-item {
      margin-top: 14px;
      padding: 16px;
      border-radius: 18px;
      border-left: 12px solid;
      background: rgba(255,255,255,0.04);
      font-size: 21px;
    }

    .ing-good {
      border-left-color: #2ecc71;
      background: rgba(46,204,113,0.12);
    }

    .ing-neutral {
      border-left-color: #3498db;
      background: rgba(52,152,219,0.12);
    }

    .ing-caution {
      border-left-color: #f39c12;
      background: rgba(243,156,18,0.14);
    }

    .ing-warning {
      border-left-color: #e74c3c;
      background: rgba(231,76,60,0.14);
    }

    .ingredient-sub {
      opacity: 0.85;
      font-size: 18px;
      margin-top: 6px;
    }

    /* IMAGE MODAL */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
    }

    .modal img {
      max-width: 92%;
      max-height: 92%;
      border-radius: 20px;
      cursor: zoom-in;
      transition: transform 0.25s ease;
    }

    .modal img.zoomed {
      transform: scale(2);
      cursor: zoom-out;
    }
  </style>
</head>

<body>
  <div class="container">

    <div class="product-header">
      <h1>Ingredient Translator</h1>
      <button onclick="searchProduct()">üîç Search Product</button>
    </div>

    <div id="productInfo" class="card" style="display:none;">
      <div class="product-header">
        <img id="productImage">
        <h2 id="productName"></h2>
        <div class="meta" id="productBrand"></div>
        <div class="serving" id="servingInfo"></div>
      </div>
    </div>

    <div class="card">
      <textarea id="input" placeholder="Paste ingredients here..."></textarea>
      <button style="margin-top:12px;" onclick="analyze()">üîç Translate Ingredients</button>
    </div>

    <div class="card" id="results" style="display:none;">
      <h3>Ingredient Breakdown</h3>
      <div id="ingredientsList"></div>
    </div>

  </div>

  <!-- IMAGE MODAL -->
  <div class="modal" id="imageModal" onclick="closeModal()">
    <img id="modalImg">
  </div>

<script>
let selectedProductData = null;

function escapeHtml(s){
  return s.replace(/[&<>"']/g, c =>
    ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])
  );
}

function searchProduct(){
  const q = prompt("Enter product name");
  if(!q) return;

  fetch(
    "https://world.openfoodfacts.org/cgi/search.pl?search_terms=" +
    encodeURIComponent(q) +
    "&search_simple=1&action=process&json=1&page_size=20&countries_tags_en=united-states&sort_by=unique_scans_n"
  )
  .then(r=>r.json())
  .then(d=>{
    if(d.products && d.products.length){
      showProduct(d.products[0], d.products[0].code);
    }
  });
}

function showProduct(product, code){
  document.getElementById("productInfo").style.display="block";

  const name = product.product_name || "Unknown Product";
  const brand = product.brands || "";
  const img = product.image_front_small_url || "";
  const full = product.image_front_url || img;

  selectedProductData = {
    servingSize: product.serving_size || "",
    servingQty: product.serving_quantity || null,
    ingredients: product.ingredients || []
  };

  document.getElementById("productName").textContent = name;
  document.getElementById("productBrand").textContent = brand ? "by "+brand : "Barcode "+code;

  if(img){
    const im = document.getElementById("productImage");
    im.src = img;
    im.style.display="block";
    im.onclick = e => { e.stopPropagation(); openModal(full); };
  }

  renderServing();
}

function renderServing(){
  const el = document.getElementById("servingInfo");
  if(!selectedProductData) return;

  if(selectedProductData.servingSize){
    el.textContent = "Serving size: " + selectedProductData.servingSize;
  } else {
    el.textContent = "Serving size: not provided";
  }
}

function analyze(){
  const raw = document.getElementById("input").value;
  if(!raw) return;

  const list = raw.split(",").map(i=>i.trim()).filter(Boolean);
  const out = document.getElementById("ingredientsList");
  out.innerHTML = "";

  list.forEach(name=>{
    let cls = "ing-neutral";
    const n = name.toLowerCase();

    if(/sugar|corn syrup|artificial|color|red \d|yellow \d/.test(n)) cls="ing-warning";
    else if(/emulsifier|stabilizer|preservative|flavor/.test(n)) cls="ing-caution";
    else if(/whole|fruit|vegetable|oat|nut|seed/.test(n)) cls="ing-good";

    const div = document.createElement("div");
    div.className = "ingredient-item " + cls;
    div.innerHTML = "<strong>"+escapeHtml(name)+"</strong>";
    out.appendChild(div);
  });

  document.getElementById("results").style.display="block";
}

function openModal(src){
  const m = document.getElementById("imageModal");
  const i = document.getElementById("modalImg");
  i.src = src;
  i.classList.remove("zoomed");
  i.onclick = e => { e.stopPropagation(); i.classList.toggle("zoomed"); };
  m.style.display="flex";
}

function closeModal(){
  document.getElementById("imageModal").style.display="none";
}
</script>

</body>
</html>